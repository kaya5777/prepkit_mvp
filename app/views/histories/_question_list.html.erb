<div class="mb-8 bg-white rounded-lg shadow-sm border border-secondary-200 overflow-hidden">
  <div class="bg-gradient-to-r from-primary-50 to-primary-100 px-6 py-4 border-b border-primary-200 flex items-center justify-between">
    <h2 class="text-xl font-bold text-secondary-900">想定質問リスト</h2>
    <% if defined?(history) && history && history.question_answers.scored.any? %>
      <%= link_to history_question_answers_path(history), class: "inline-flex items-center px-3 py-1.5 bg-white hover:bg-secondary-50 rounded-lg text-sm font-medium text-primary-700 transition-colors border border-primary-200" do %>
        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
        </svg>
        全ての回答履歴
      <% end %>
    <% end %>
  </div>
  <div class="p-6">
    <ul class="space-y-4">
      <% questions.each_with_index do |q, index| %>
        <% if q.is_a?(Hash) %>
          <!-- 新形式: intent, answer_points, level付き -->
          <li class="border border-secondary-200 rounded-lg p-5 bg-gradient-to-br from-white to-secondary-50">
            <div class="flex gap-3 mb-3">
              <%= numbered_badge(index + 1, color_class: "bg-primary-500") %>
              <div class="flex-1">
                <span class="text-lg font-semibold text-secondary-900">
                  <%= q[:question] || q["question"] %>
                </span>
              </div>
            </div>

            <% if (q[:intent] || q["intent"]).present? %>
              <div class="ml-11 mb-3 p-3 bg-amber-50 border-l-4 border-amber-400 rounded">
                <div class="flex gap-2 items-start">
                  <svg class="w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M11 3a1 1 0 10-2 0v1a1 1 0 102 0V3zM15.657 5.757a1 1 0 00-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM18 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM5.05 6.464A1 1 0 106.464 5.05l-.707-.707a1 1 0 00-1.414 1.414l.707.707zM5 10a1 1 0 01-1 1H3a1 1 0 110-2h1a1 1 0 011 1zM8 16v-1h4v1a2 2 0 11-4 0zM12 14c.015-.34.208-.646.477-.859a4 4 0 10-4.954 0c.27.213.462.519.476.859h4.002z"/>
                  </svg>
                  <div class="flex-1">
                    <div class="text-xs font-semibold text-amber-800 mb-1">面接官の意図</div>
                    <div class="text-sm text-amber-900"><%= q[:intent] || q["intent"] %></div>
                  </div>
                </div>
              </div>
            <% end %>

            <% answer_points = q[:answer_points] || q["answer_points"] %>
            <% if answer_points.present? && answer_points.any? %>
              <div class="ml-11 p-3 bg-primary-50 rounded">
                <div class="flex gap-2 items-start">
                  <svg class="w-5 h-5 text-primary-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                  </svg>
                  <div class="flex-1">
                    <div class="text-xs font-semibold text-primary-800 mb-2">回答のポイント</div>
                    <ul class="space-y-1.5">
                      <% answer_points.each do |point| %>
                        <li class="flex gap-2 items-start">
                          <span class="text-primary-600 text-sm flex-shrink-0">•</span>
                          <span class="text-sm text-secondary-700"><%= point %></span>
                        </li>
                      <% end %>
                    </ul>
                  </div>
                </div>
              </div>
            <% end %>

            <!-- 回答を練習ボタン -->
            <% if defined?(history) && history %>
              <div class="ml-11 mt-3">
                <%= link_to new_history_question_answer_path(history, question_index: index), class: "inline-flex items-center px-4 py-2 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white font-semibold rounded-lg elevation-1 hover:elevation-2 transition-all text-sm" do %>
                  <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                  </svg>
                  回答を練習
                <% end %>

                <!-- 過去の練習回答 -->
                <% past_answers = history.question_answers.for_question(index).scored.recent_first.limit(3) %>
                <% if past_answers.any? %>
                  <div class="mt-3 pt-3 border-t border-secondary-200">
                    <div class="text-xs font-semibold text-secondary-700 mb-2">過去の練習回答（<%= past_answers.count %>回）</div>
                    <div class="space-y-2">
                      <% past_answers.each do |answer| %>
                        <%= link_to history_question_answer_path(history, answer), class: "flex items-center gap-2 p-2 bg-secondary-50 hover:bg-secondary-100 rounded text-sm transition-colors" do %>
                          <svg class="w-4 h-4 text-secondary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                          </svg>
                          <span class="text-secondary-700 flex-1"><%= answer.created_at.strftime('%Y/%m/%d %H:%M') %></span>
                          <span class="px-2 py-0.5 <%= answer.score >= 80 ? 'bg-green-100 text-green-800' : answer.score >= 60 ? 'bg-blue-100 text-blue-800' : 'bg-amber-100 text-amber-800' %> rounded text-xs font-semibold">
                            <%= answer.score %>点
                          </span>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </li>
        <% else %>
          <!-- 旧形式: 文字列のみ -->
          <li class="flex gap-3 p-4 bg-secondary-50 rounded-lg">
            <%= numbered_badge(index + 1, color_class: "bg-primary-500") %>
            <span class="flex-1 text-secondary-800"><%= q %></span>
          </li>
        <% end %>
      <% end %>
    </ul>
  </div>
</div>
