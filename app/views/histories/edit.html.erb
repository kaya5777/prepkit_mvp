<h1>メモ編集</h1>
<%= form_with(model: @history, local: true) do |form| %>
  <div>
    <%= form.label :company_name, '会社名' %><br>
    <%= form.text_field :company_name, value: @history.company_name, required: false %>
  </div>
  <div>
    <%= form.label :content, '想定質問（AI出力）' %><br>
    <% begin %>
      <% content_hash = JSON.parse(@history.content) rescue nil %>
      <% if content_hash.is_a?(Hash) %>
        <% if content_hash['questions'] || content_hash[:questions] %>
          <div style="margin-bottom:6px"><strong>質問リスト</strong></div>
          <ul style="margin-left:18px;margin-bottom:14px;">
            <% (content_hash['questions'] || content_hash[:questions]).each do |q| %>
              <li><%= q %></li>
            <% end %>
          </ul>
        <% end %>
        <% if content_hash['star_answers'] || content_hash[:star_answers] %>
          <div style="margin-bottom:6px"><strong>STAR回答</strong></div>
          <% (content_hash['star_answers'] || content_hash[:star_answers]).each do |s| %>
            <div style="margin-bottom:8px; padding-left:10px;">
              <strong>質問:</strong> <%= s['question'] || s[:question] %><br>
              <strong>S:</strong> <%= s['situation'] || s[:situation] %><br>
              <strong>T:</strong> <%= s['task'] || s[:task] %><br>
              <strong>A:</strong> <%= s['action'] || s[:action] %><br>
              <strong>R:</strong> <%= s['result'] || s[:result] %>
            </div>
          <% end %>
        <% end %>
        <% if content_hash['reverse_questions'] || content_hash[:reverse_questions] %>
          <div style="margin-bottom:6px"><strong>逆質問</strong></div>
          <ul style="margin-left:18px;margin-bottom:14px;">
            <% (content_hash['reverse_questions'] || content_hash[:reverse_questions]).each do |q| %>
              <li><%= q %></li>
            <% end %>
          </ul>
        <% end %>
        <% if content_hash['tech_checklist'] || content_hash[:tech_checklist] %>
          <div style="margin-bottom:6px"><strong>技術チェックリスト</strong></div>
          <ul style="margin-left:18px;margin-bottom:14px;">
            <% (content_hash['tech_checklist'] || content_hash[:tech_checklist]).each do |q| %>
              <li><%= q %></li>
            <% end %>
          </ul>
        <% end %>
      <% else %>
        <p style="background:#f7f7f8; padding:8px 10px; border-radius:6px; border:1px solid #ececec; font-size:0.98em;"> <%= @history.content %> </p>
      <% end %>
    <% rescue %>
      <p style="background:#f7f7f8; padding:8px 10px; border-radius:6px; border:1px solid #ececec; font-size:0.98em;"> <%= @history.content %> </p>
    <% end %>
  </div>
  <div>
    <%= form.label :memo, 'メモ' %><br>
    <%= form.text_area :memo, style: 'min-height:220px;width:98%;font-size:1.1em;padding:12px;', rows:12, cols:80 %>
  </div>
  <div>
    <%= form.submit '更新' %>
    <%= link_to '戻る', root_path %>
  </div>
<% end %>
